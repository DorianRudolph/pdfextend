<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="pdfium.js"></script>
    <script src="pdfextend_web.js"></script>
</head>

<body>
    <input type="file" accept=".pdf" id="file" />
    <br />
    <button id="run">Run!</button>
    <br />
    <canvas id="canvas" style="max-width: 100%; height: auto; border: 1px solid black;"></canvas>

    <script>
        const {
            initialize_pdfium_render,
            log_page_metrics_to_console,
            get_image_data_for_page,
            extend_pdf
        } = wasm_bindgen;

        const btnRun = document.getElementById('run');
        const fileInput = document.getElementById('file');
        const canvas = document.getElementById('canvas');

        let worker = new Worker('worker.js');
        worker.onmessage = e => {
            const msg = e.data;
            console.log('receive', msg);
            if (msg.type == 'extend') {
                canvas.width = msg.preview.width;
                canvas.height = msg.preview.height;
                const context = canvas.getContext("2d");
                context.putImageData(msg.preview, 0, 0);
            }
        }

        btnRun.onclick = async e => {
            if (!fileInput.files) {
                alert("Open a PDF first");
                return;
            }
            const msg = {
                type: 'extend',
                file: fileInput.files[0],
                command: `pdfextend input.pdf output.pdf --right=50 --grid=squares`
            }
            worker.postMessage(msg);
        };

    </script>
</body>

</html>