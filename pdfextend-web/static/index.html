<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="pdfium.js"></script>
    <script src="pdfextend_web.js"></script>
</head>

<body>
    <input type="file" accept=".pdf" id="file" />
    <br />
    <button id="run">Run!</button>
    <br />
    <canvas id="canvas" style="max-width: 100%; height: auto; border: 1px solid black;"></canvas>

    <script>
        const {
            initialize_pdfium_render,
            log_page_metrics_to_console,
            get_image_data_for_page,
            extend_pdf
        } = wasm_bindgen;

        const btnRun = document.getElementById('run');
        const fileInput = document.getElementById('file');
        const canvas = document.getElementById('canvas');

        btnRun.onclick = async e => {
            if (!fileInput.files) {
                alert("Open a PDF first");
                return;
            }
            const inputFile = fileInput.files[0];
            console.log(file);
            const res = await extend_pdf("pdfextend i.pdf o.pdf", inputFile);
            const outputFile = res.get_file();
            const preview = res.get_preview();

            console.log('done', outputFile, preview);

            canvas.width = preview.width;
            canvas.height = preview.height;
            const context = canvas.getContext("2d");
            context.putImageData(preview, 0, 0);
        };

        PDFiumModule().then(async mod => {
            Module = mod;
            wasmTable = Module.asm.__indirect_function_table;

            rustModule = await wasm_bindgen('pdfextend_web_bg.wasm');

            console.assert(
                initialize_pdfium_render(
                    Module,
                    rustModule,
                    true,
                ),
                "Initialization of pdfium-render failed!"
            );
            console.log("PDFium initialized.");
        });

    </script>
</body>

</html>